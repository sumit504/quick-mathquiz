<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Math</title>
    
    <meta name="fc:miniapp" content='{
        "version":"1",
        "imageUrl":"https://quick-mathquiz-tau.vercel.app/image.png",
        "button":{
            "title":"Play Quick Math & Earn!",
            "action":{
                "type":"launch_frame",
                "name":"Quick Math",
                "url":"https://quick-mathquiz-tau.vercel.app",
                "splashImageUrl":"https://quick-mathquiz-tau.vercel.app/splash.png",
                "splashBackgroundColor":"#cce5ff"
            }
        }
    }' />

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #87CEEB; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 0px; }
        .game-container { background: rgb(201, 221, 253); border-radius: 0px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2); max-width: 0px; width: 100%; overflow: hidden; height: 100vh; overflow-y: auto; }
        .game-header { background: #264bb1; color: white; padding: 25px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .game-title-section { display: flex; align-items: center; gap: 25px; }
        .header-avatar { width: 100px; height: 100px; border-radius: 12px; background: #444; display: none; align-items: center; justify-content: center; font-size: 25px; font-weight: bold; overflow: hidden; border: 2px solid #ffffff; }
        .header-avatar.show { display: flex; }
        .header-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .game-title { font-size: 24px; font-weight: bold; white-space: nowrap; }
        .leaderboard-btn { background: #EAB308; color: black; border: none; padding: 10px 10px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .leaderboard-btn:hover { background: #CA8A04; transform: scale(1.05); }
        .stats { display: flex; gap: 20px; margin-bottom: 15px; font-size: 14px; }
        .progress-boxes { display: flex; gap: 8px; }
        .progress-box { flex: 1; height: 48px; border-radius: 10px; border: 2px solid #a2a2a2; display: flex; align-items: center; justify-content: center; font-weight: bold; transition: all 0.3s; }
        .progress-box.correct { background: #22C55E; border-color: #cfffe1; color: white; }
        .progress-box.active { background: #EAB308; border-color: #CA8A04; color: white; }
        .progress-box.inactive { background: #374151; border-color: #e2e2e2; color: #e6eeff; }
        .game-content { padding: 30px; }
        .start-screen, .game-screen, .result-screen { text-align: center; }
        .game-icon { font-size: 80px; margin-bottom: 20px; }
        .wallet-container { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(74, 144, 226, 0.3); border-radius: 15px; padding: 15px; margin: 20px 0; backdrop-filter: blur(10px); text-align: center; }
        .wallet-status { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; font-size: 14px; color: #1F2937; }
        .wallet-indicator { width: 10px; height: 10px; border-radius: 50%; background: #ef4444; animation: pulse 2s infinite; }
        .wallet-indicator.connected { background: #10b981; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        #walletAddress { font-family: monospace; margin: 8px 0; font-size: 13px; color: #6B7280; }
        .game-screen .question-number { color: #6B7280; margin-bottom: 10px; font-size: 14px; }
        .question { font-size: 48px; font-weight: bold; color: #1F2937; margin-bottom: 15px; }
        .feedback { font-size: 24px; font-weight: bold; min-height: 30px; margin-bottom: 15px; }
        .feedback.correct { color: #22C55E; }
        .feedback.wrong { color: #EF4444; }
        .falling-area { position: relative; height: 400px; background: linear-gradient(to bottom, #DBEAFE, #BFDBFE); border-radius: 20px; border: 4px solid #60A5FA; overflow: hidden; }
        .falling-answer { position: absolute; width: 70px; height: 70px; background: white; border: 4px solid #60A5FA; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: #3B82F6; cursor: pointer; transition: transform 0.1s; animation: fall 6s linear forwards; margin-left: -35px; }
        .falling-answer:nth-child(1) { left: 20%; }
        .falling-answer:nth-child(2) { left: 40%; }
        .falling-answer:nth-child(3) { left: 60%; }
        .falling-answer:nth-child(4) { left: 80%; }
        .falling-answer:hover { transform: scale(1.1); }
        .falling-answer:active { transform: scale(0.95); }
        @keyframes fall { from { top: -100px; opacity: 1; } to { top: 100%; opacity: 1; } }
        .btn { padding: 15px 30px; border: none; border-radius: 15px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-primary { background: linear-gradient(45deg, #264bb1,#264bb1); color: white; box-shadow: 0 5px 15px rgba(99, 99, 241, 0.3); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-success { background: linear-gradient(45deg, #22C55E, #16A34A); color: white; }
        .btn-warning { background: linear-gradient(45deg, #EAB308, #CA8A04); color: black; }
        .btn-share { background: linear-gradient(45deg, #A855F7, #922dd1); color: white; }
        .button-group { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .button-row { display: flex; gap: 10px; }
        .button-row .btn { flex: 1; }
        .result-time { font-size: 28px; font-weight: bold; color: #22C55E; margin: 15px 0; }
        .leaderboard-screen { padding: 30px; }
        .leaderboard-title { font-size: 24px; font-weight: bold; color: #1F2937; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .leaderboard-list { margin-bottom: 20px; max-height: 500px; overflow-y: auto; }
        .leaderboard-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 8px; border-radius: 12px; border: 1px solid #E5E7EB; }
        .leaderboard-item.rank-1 { background: #b6d2f5ef; border: 2px solid #000000; }
        .leaderboard-item.rank-2 { background: #cad3e5; border: 2px solid #000000; }
        .leaderboard-item.rank-3 { background: #bbacdd; border: 2px solid #000000; }
        .leaderboard-left { display: flex; align-items: center; gap: 15px; }
        .rank-icon { font-size: 28px; }
        .player-info .player-name { font-weight: bold; color: #1F2937; }
        .player-info .player-time { font-size: 14px; color: #122854; }
        .player-info .player-address { font-size: 12px; color: #9CA3AF; font-family: monospace; }
        .empty-leaderboard { text-align: center; padding: 40px; color: #6B7280; }
        .hidden { display: none !important; }
        .success-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px 30px; border-radius: 15px; font-size: 18px; font-weight: bold; box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 10000; text-align: center; max-width: 90%; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #6366F1; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* NFT Mint Card Styles */
        .nft-mint-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f172a 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            border: 2px solid #324b6c;
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.3);
            z-index: 10000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(15px);
        }

        .nft-mint-card.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .nft-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            color: #e2e8f0;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nft-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .nft-header {
            margin-bottom: 25px;
        }

        .nft-title {
            font-size: 1.8em;
            color: #f1f5f9;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .nft-subtitle {
            color: #64748b;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .nft-image {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, #5caae6 0%, #75a3f3 50%, #87b1f6 100%);
            border-radius: 15px;
            position: relative;
            margin-bottom: 25px;
            overflow: hidden;
            border: 2px solid rgb(249, 251, 255);
        }

        .nft-cover-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .nft-details {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .nft-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .nft-price {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #f1f5f9;
            font-size: 1.1em;
            font-weight: 600;
        }

        .nft-remaining {
            color: #20e7b5;
            font-size: 0.9em;
        }

        .eth-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .nft-mint-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .nft-mint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.6);
        }

        .nft-mint-btn:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .nft-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .nft-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        @media (max-width: 600px) { .game-container { max-width: 100%; } .question { font-size: 36px; } .falling-area { height: 350px; } .game-title { font-size: 20px; } .header-avatar { width: 70px; height: 70px; font-size: 40px; } }
    </style>
</head>
<body>
    <!-- NFT Mint Overlay -->
    <div id="nftOverlay" class="nft-overlay"></div>

    <!-- NFT Mint Card -->
    <div id="nftMintCard" class="nft-mint-card">
        <button class="nft-close-btn" onclick="hideNFTMint()">√ó</button>
        
        <div class="nft-header">
            <h3 class="nft-title">Quick Math NFT</h3>
            <p class="nft-subtitle">Limited to 999 Supply, Let's celebrate this moment and make it memorable.</p>
        </div>

        <div class="nft-image">
            <img src="image.png" alt="Quick Math NFT" class="nft-cover-image">
        </div>

        <div class="nft-details">
            <div class="nft-price-row">
                <div class="nft-price">
                    <div class="eth-icon">
                        <img src="arb.png" alt="Gift" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <span>FREE MINT</span>
                </div>
                <div class="nft-remaining">Minted: 0/999</div>
            </div>
        </div>

        <button class="nft-mint-btn" onclick="mintNFT()">Mint Now!</button>
    </div>

    <audio id="correctSound" preload="auto"><source src="sounds/correct.mp3" type="audio/mpeg"></audio>
    <audio id="wrongSound" preload="auto"><source src="sounds/wrong.mp3" type="audio/mpeg"></audio>
    <audio id="winSound" preload="auto"><source src="sounds/win.mp3" type="audio/mpeg"></audio>
    
    <div class="game-container">
        <div class="game-header">
            <div class="header-top">
                <div class="game-title-section">
                    <div class="header-avatar" id="headerAvatar">?</div>
                    <div class="game-title"> Quick Math </div>
                </div>
                <button class="leaderboard-btn" onclick="toggleLeaderboard()">Leaderboard</button>
            </div>
            <div class="stats"><div id="timerDisplay" class="hidden">‚è±Ô∏è <span id="timer">0.00s</span></div></div>
            <div class="progress-boxes">
                <div class="progress-box inactive">1</div>
                <div class="progress-box inactive">2</div>
                <div class="progress-box inactive">3</div>
                <div class="progress-box inactive">4</div>
            </div>
        </div>

        <div class="game-content" id="startScreen">
            <div class="start-screen">
                <div class="game-icon">üìü</div>
                <h2 style="font-size: 28px; margin-bottom: 15px; color: #1F2937;">‚è±Ô∏è Math vs Time - Go!</h2>
                <p style="color: #011b4c; margin-bottom: 10px;">Answer 4 questions correctly to win.</p>
                <p style="color: #1a1a1b; font-size: 14px; margin-bottom: 20px;">üåê Beat the clock, own the leaderboard!</p>
                <div class="wallet-container">
                    <div class="wallet-status">
                        <div class="wallet-indicator" id="walletIndicator"></div>
                        <span id="walletStatus">Not Connected</span>
                    </div>
                    <div id="walletInfo" style="display: none;"><div id="walletAddress"></div></div>
                    <button class="btn btn-primary" id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
                </div>
                <button class="btn btn-primary" id="playBtn" onclick="startGame()" disabled>Start Game</button>
            </div>
        </div>

        <div class="game-content hidden" id="gameScreen">
            <div class="game-screen">
                <div class="question-number" id="questionNumber">Question 1 of 4</div>
                <div class="question" id="question">5 + 3 = ?</div>
                <div class="feedback" id="feedback"></div>
                <div class="falling-area" id="fallingArea"></div>
            </div>
        </div>

        <div class="game-content hidden" id="resultScreen">
            <div class="result-screen">
                <div class="game-icon" id="resultIcon">üèÜ</div>
                <h2 style="font-size: 32px; margin-bottom: 15px; color: #1F2937;" id="resultTitle">You Win!</h2>
                <p style="color: #6B7280; margin-bottom: 10px;" id="resultText">Perfect Score! 4/4 correct! </p>
                <div class="result-time" id="resultTime">‚è±Ô∏è 0.00s</div>
                <div class="button-group">
                    <button class="btn btn-success" style="width: 100%;" onclick="submitScoreOnChain()">üìä Save to Leaderboard</button>
                    <button class="btn btn-warning" style="width: 100%;" onclick="claimRewardOnChain()">üí∞ Claim Reward</button>
                    <button class="btn btn-primary" style="width: 100%;" onclick="showLeaderboard()">üèÜ View Leaderboard</button>
                    <div class="button-row">
                        <button class="btn btn-primary" onclick="playAgain()">Play Again</button>
                        <button class="btn btn-share" onclick="shareGame()">üì± Share</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="leaderboard-screen hidden" id="leaderboardScreen">
            <h2 class="leaderboard-title">‚è±Ô∏è Top 50 Fastest Players</h2>
            <div class="leaderboard-list" id="leaderboardList">
                <div class="empty-leaderboard"><p style="font-size: 18px; margin-bottom: 5px;">Loading leaderboard...</p><div class="loading-spinner"></div></div>
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="hideLeaderboard()">Back to Game</button>
        </div>
    </div>

    <script type="module" src="/main.js"></script>
</body>
</html>